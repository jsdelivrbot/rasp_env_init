---
# common tasks env init

- name: Set up authorized keys
  authorized_key:
    user: pirate
    state: present
    # path: "/pirate/.ssh/authorized_keys"
    key: '{{ item }}'
  with_file:
    - liangzh_id_ras.pub

- name: change passwd
  shell: 'echo "pirate:1q2w3e"|chpasswd'

- name: apt upgrade
  apt: upgrade=yes update_cache=yes
# upgrade=dist

- name: 替换国内apt源
  copy: src=source.list dest=/etc/apt/source.list

- name: apt-get install
  apt: name={{ item }}
  with_items: 
   - strace
   - ebtables
   - socat
   - git

#zsh start
- name: apt-get install zsh -y
  apt: name=zsh 
- name: 安装oh-my-zsh
  raw: 'curl -L https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh | sh'
- name: 修改zsh为系统默认shell
  shell: chsh -s /bin/zsh root
- name: 修改zsh为系统默认shell
  shell: chsh -s /bin/zsh pirate
- name: add .zshrc
  copy: src=zshrc dest=/home/pirate/.zshrc
#zsh finish

#vim start
- name: apt-get install vim -y
  apt: name=vim
- name : vimrc
  copy: src=vimrc dest=/home/pirate/.vimrc
- name : vimrc
  copy: src=vimrc dest=/root/.vimrc
#vim finish

### k8s start
- name: copy k8s deb
  copy: src={{ item.src }} dest={{ item.dest }}
  with_items:
   - {src: 'k8s_deb/kubeadm_1.5.0-alpha.0-1534-gcf7301f-00_armhf_1c365734c7e7b034d604d5438de69372c279be82026628d2c6b60a6733e7c474.deb',dest: '/tmp/kubeadm_1.5.0.deb'}
   - {src: 'k8s_deb/kubectl_1.4.3-00_armhf_da94775a34702fbd9cf8fcb02ff8d11e7bd04a750263978d0e5ecab7338415c7.deb',dest: '/tmp/kubectl_1.4.3.deb'}
   - {src: 'k8s_deb/kubelet_1.4.3-00_armhf_ea5a5c6fda97f8836c70d5b9d9b18d62b2dacbfd5ce93a6b0f280944ec60b506.deb',dest: '/tmp/kubelet_1.4.3.deb'}
   - {src: 'k8s_deb/kubernetes-cni_0.3.0.1-07a8a2-00_armhf_192f7340f3e6b29b284b25a2aaed96db2f7f5335962622a259f80d2993d392c3.deb',dest: '/tmp/kubernetes-cni_0.3.0.1.deb'}
- name: dpkg安装k8s
  apt: deb={{ item }}
  with_items:
    - /tmp/kubeadm_1.5.0.deb
    - /tmp/kubectl_1.4.3.deb
    - /tmp/kubelet_1.4.3.deb
    - /tmp/kubernetes-cni_0.3.0.1.deb
### k8s finish





